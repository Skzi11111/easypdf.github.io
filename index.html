<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js';
</script>
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<canvas id="pdf-canvas"></canvas>
<input type="file" id="upload-file" accept="application/pdf"/>
<button id="prev-btn">Prev</button>
<button id="next-btn">Next</button>
<button id="rotate-btn">Rotate</button>
<button id="delete-btn">Delete Page</button>
<button id="pagenum-btn">Add Page Numbers</button>

<script>
  let pdfDoc, currentPage = 1, scale = 1.2;
  const canvas = document.getElementById('pdf-canvas'), ctx = canvas.getContext('2d');
  async function renderPage() {
    const page = await pdfDoc.getPage(currentPage);
    const vp = page.getViewport({ scale });
    canvas.width = vp.width; canvas.height = vp.height;
    await page.render({ canvasContext: ctx, viewport: vp }).promise;
  }

  document.getElementById('upload-file').onchange = async e => {
    const u8 = new Uint8Array(await e.target.files[0].arrayBuffer());
    pdfDoc = await pdfjsLib.getDocument({ data: u8 }).promise;
    currentPage = 1; await renderPage();
  };

  document.getElementById('prev-btn').onclick = () => { if (currentPage>1) currentPage--, renderPage(); };
  document.getElementById('next-btn').onclick = () => { if (currentPage<pdfDoc.numPages) currentPage++, renderPage(); };

  document.getElementById('rotate-btn').onclick = async () => {
    const existing = await pdfDoc.save();
    const doc = await PDFLib.PDFDocument.load(existing);
    const pg = doc.getPages()[currentPage - 1];
    pg.setRotation(pg.getRotation().rotate(90));
    const bytes = await doc.save();
    pdfDoc = await pdfjsLib.getDocument({ data: bytes }).promise;
    await renderPage();
  };

  document.getElementById('delete-btn').onclick = async () => {
    const existing = await pdfDoc.save();
    const doc = await PDFLib.PDFDocument.load(existing);
    doc.removePage(currentPage - 1);
    const bytes = await doc.save();
    pdfDoc = await pdfjsLib.getDocument({ data: bytes }).promise;
    if (currentPage > pdfDoc.numPages) currentPage = pdfDoc.numPages;
    await renderPage();
  };

  document.getElementById('pagenum-btn').onclick = async () => {
    const existing = await pdfDoc.save();
    const doc = await PDFLib.PDFDocument.load(existing);
    doc.getPages().forEach((p,i)=>{
      p.drawText(`Page ${i+1}`, { x: p.getWidth()-60, y:20, size:12 });
    });
    const bytes = await doc.save();
    pdfDoc = await pdfjsLib.getDocument({ data: bytes }).promise;
    await renderPage();
  };
</script>
